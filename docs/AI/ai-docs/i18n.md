# Yao Agent i18n Reference

## Overview

The i18n (internationalization) system provides localization support for agents, allowing multi-language content in prompts, messages, and UI elements.

## Locale Files

Locale files are placed in the `locales/` directory of an assistant:

```
assistants/expense/
├── package.yao
├── locales/
│   ├── en.yml        # English
│   ├── zh-cn.yml     # Simplified Chinese
│   └── ja.yml        # Japanese
└── prompts/
    └── system.prompt.yao
```

## Locale File Format

```yaml
# locales/en.yml
messages:
  greeting: 'Hello, welcome!'
  expense.submit: 'Submit expense report'
  expense.approve: 'Approve expense'
  error.invalid_amount: 'Invalid amount: {{amount}}'
```

```yaml
# locales/zh-cn.yml
messages:
  greeting: '您好，欢迎！'
  expense.submit: '提交费用报告'
  expense.approve: '批准费用'
  error.invalid_amount: '金额无效: {{amount}}'
```

## Using i18n in Prompts

### Direct Key Reference

```json
{
  "role": "system",
  "content": "{{greeting}}"
}
```

### Embedded Variables

```json
{
  "role": "system",
  "content": "{{greeting}} Your expense limit is {{expense.limit}}."
}
```

## Context Locale

The locale is determined from the context:

```typescript
// In hooks, locale is available from context
function Create(ctx: agent.Context, messages: agent.Message[]): agent.Create {
  console.log('User locale:', ctx.locale); // e.g., "en", "zh-cn"

  return {
    messages,
    locale: 'zh-cn' // Override locale if needed
  };
}
```

## Built-in Messages

The system provides built-in i18n messages for common operations:

| Key                         | English                     | Description          |
| --------------------------- | --------------------------- | -------------------- |
| `search.loading`            | "Searching..."              | Search in progress   |
| `search.success`            | "Found %d references"       | Search completed     |
| `search.no_results`         | "No results found"          | Empty search results |
| `search.failed`             | "Search failed"             | Search error         |
| `search.intent.loading`     | "Analyzing query..."        | Intent detection     |
| `search.intent.need_search` | "Search needed"             | Intent result        |
| `search.intent.no_search`   | "No search needed"          | Intent result        |
| `search.keyword.loading`    | "Extracting keywords..."    | Keyword extraction   |
| `search.keyword.done`       | "Keywords extracted"        | Keyword complete     |
| `search.trace.label`        | "Search"                    | Trace node label     |
| `search.trace.description`  | "Searching for information" | Trace description    |

## Locale Resolution Priority

1. **Hook override**: `createResponse.locale`
2. **Request header**: `Accept-Language`
3. **User preference**: Stored in user settings
4. **Default**: `en-us`

## Template Syntax

### Simple Variable

```
{{variable_name}}
```

### Nested Keys

```
{{category.subcategory.key}}
```

### With Context Variables

Combine i18n with context variables:

```
Welcome {{$CTX.USER_ID}}! {{greeting}}
```

## Localizing Assistant Metadata

In `package.yao`, use locale-specific fields:

```json
{
  "name": "Expense Assistant",
  "name:zh-cn": "费用助手",
  "name:ja": "経費アシスタント",

  "description": "Manage your expenses",
  "description:zh-cn": "管理您的费用",
  "description:ja": "経費を管理する",

  "placeholder": {
    "title": "Expense Assistant",
    "title:zh-cn": "费用助手",
    "prompts": ["Submit an expense", "Query expenses"],
    "prompts:zh-cn": ["提交费用", "查询费用"]
  }
}
```

## API Usage

```typescript
// Import i18n helper (internal use)
import { i18n } from '@yao/runtime';

// Get translated message
const msg = i18n.T(ctx.locale, 'search.loading');

// With format arguments
const msg = i18n.T(ctx.locale, 'search.success', count);
```

## Best Practices

1. **Use keys** - Define message keys, not hardcoded strings
2. **Organize by feature** - Group related keys (e.g., `expense.submit`)
3. **Provide fallbacks** - Always have English as fallback
4. **Test locales** - Verify all supported languages work
5. **Keep consistent** - Use same key structure across locales

## See Also

- [Assistant Structure](./assistant-structure.md)
- [Agent Context API](./agent-context-api.md)
- [Hooks Reference](./hooks-reference.md)
