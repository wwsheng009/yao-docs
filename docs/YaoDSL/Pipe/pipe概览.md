# Pipe æ¦‚è§ˆ

Pipe æ˜¯ Yao æ¡†æ¶ä¸­ç”¨äºå¤æ‚é€»è¾‘ç¼–æ’çš„ Widgetï¼Œä½œä¸º Flow çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒæä¾›äº†ä¸€ç§åŸºäºèŠ‚ç‚¹çš„æµç¨‹ç¼–æ’æ–¹å¼ï¼Œæ”¯æŒæ¡ä»¶åˆ†æ”¯ã€AI é›†æˆã€ç”¨æˆ·äº¤äº’ç­‰é«˜çº§åŠŸèƒ½ã€‚

## ğŸš¨ é‡è¦æç¤º

**Pipe Widget æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚**

## æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **é€»è¾‘ç¼–æ’**: é€šè¿‡èŠ‚ç‚¹ç»„åˆå®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘
- ğŸ”€ **æ¡ä»¶åˆ†æ”¯**: æ”¯æŒ Switch èŠ‚ç‚¹è¿›è¡Œæ¡ä»¶åˆ¤æ–­
- ğŸ¤– **AI é›†æˆ**: å†…ç½® AI èŠ‚ç‚¹ï¼Œæ”¯æŒå¤§è¯­è¨€æ¨¡å‹è°ƒç”¨
- ğŸ‘¥ **ç”¨æˆ·äº¤äº’**: æ”¯æŒå¤šç§ç”¨æˆ·è¾“å…¥ç•Œé¢ï¼ˆCLIã€Webã€Appã€å°ç¨‹åºï¼‰
- âš™ï¸ **Process è°ƒç”¨**: å¯ä»¥è°ƒç”¨ Yao Process æ‰§è¡Œä¸šåŠ¡é€»è¾‘
- ğŸŒŠ **æµå¼å¤„ç†**: æ”¯æŒæµå¼ AI å“åº”
- ğŸ’¾ **çŠ¶æ€ç®¡ç†**: æ”¯æŒä¸Šä¸‹æ–‡ä¿å­˜å’Œæ¢å¤

## ä½¿ç”¨åœºæ™¯

1. **å›¾å½¢ç•Œé¢ç”Ÿæˆ DSL**: é€šè¿‡å¯è§†åŒ–ç•Œé¢ç”Ÿæˆæµç¨‹é…ç½®
2. **ç®€å•åŠŸèƒ½æ‰©å±•**: åœ¨åº”ç”¨ç«¯å®ç°ç®€å•çš„åŠŸèƒ½é€»è¾‘æ‰©å±•
3. **äº¤äº’å¼æµç¨‹**: éœ€è¦ç”¨æˆ·è¾“å…¥çš„äº¤äº’å¼ä¸šåŠ¡æµç¨‹
4. **AI é©±åŠ¨åº”ç”¨**: é›†æˆ AI èƒ½åŠ›çš„æ™ºèƒ½åº”ç”¨

## æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    A[Pipe DSL] --> B[Pipe Engine]
    B --> C[Context Manager]
    B --> D[Node Executor]

    D --> E[Process Node]
    D --> F[AI Node]
    D --> G[Switch Node]
    D --> H[User Input Node]

    C --> I[State Storage]
    C --> J[Resume Engine]

    K[Expression Engine] --> L[Data Binding]
    L --> D

    M[Security Layer] --> N[Whitelist Check]
    N --> E
```

## æ–‡æ¡£ç»“æ„

æœ¬éƒ¨åˆ†åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

- [DSL è¯­æ³•](./dsl.md) - Pipe é…ç½®è¯­æ³•è¯¦è§£
- [èŠ‚ç‚¹ç±»å‹](./nodes.md) - å„ç§èŠ‚ç‚¹ç±»å‹çš„ä½¿ç”¨æ–¹æ³•
- [è¡¨è¾¾å¼å¼•æ“](./expression.md) - è¡¨è¾¾å¼è¯­æ³•å’Œæ•°æ®å¤„ç†
- [æ‰§è¡Œæµç¨‹](./execution.md) - Pipe çš„æ‰§è¡Œæœºåˆ¶
- [API å‚è€ƒ](./api.md) - å®Œæ•´çš„ API æ–‡æ¡£
- [æœ€ä½³å®è·µ](./best-practices.md) - ä½¿ç”¨å»ºè®®å’Œæ³¨æ„äº‹é¡¹
- [ç¤ºä¾‹ä»£ç ](./examples.md) - å®é™…åº”ç”¨æ¡ˆä¾‹

## å¿«é€Ÿå¼€å§‹

> âš ï¸ **é‡è¦**: Pipe DSL ä½¿ç”¨ **JSON æ ¼å¼**ï¼
>
> ğŸ“– æŸ¥çœ‹ [JSON æ ¼å¼è¯´æ˜](./JSON-æ ¼å¼è¯´æ˜.md) äº†è§£è¯¦ç»†çš„è½¬æ¢æŒ‡å—

### 1. åˆ›å»º Pipe é…ç½®

```json
{
  "name": "translator",
  "label": "ç¿»è¯‘åŠ©æ‰‹",
  "nodes": [
    {
      "name": "input",
      "type": "user-input",
      "ui": "cli",
      "label": "è¯·è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹"
    },
    {
      "name": "translate",
      "type": "ai",
      "prompts": [
        {
          "role": "system",
          "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹"
        },
        {
          "role": "user",
          "content": "è¯·å°†ä»¥ä¸‹å†…å®¹ç¿»è¯‘æˆè‹±æ–‡ï¼š{{ $in[0] }}"
        }
      ],
      "model": "gpt-3.5-turbo"
    },
    {
      "name": "output",
      "type": "user-input",
      "ui": "cli",
      "label": "ç¿»è¯‘ç»“æœ",
      "autofill": {
        "value": "{{ $out[1] }}"
      }
    }
  ]
}
```

### 2. è¿è¡Œ Pipe

```bash
# è¿è¡Œå·²åŠ è½½çš„ Pipe
yao run pipes.translator

# ç›´æ¥ä» DSL åˆ›å»ºå¹¶è¿è¡Œ
yao run pipe.Create '<DSL å†…å®¹>'

# æ¢å¤ä¸­æ–­çš„ Pipe
yao run pipe.Resume <context-id>
```

## æ ¸å¿ƒæ¦‚å¿µ

### èŠ‚ç‚¹ (Node)

èŠ‚ç‚¹æ˜¯ Pipe çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ç‰¹å®šçš„ç±»å‹å’ŒåŠŸèƒ½ã€‚

### ä¸Šä¸‹æ–‡ (Context)

Context ç®¡ç† Pipe çš„æ‰§è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬è¾“å…¥è¾“å‡ºã€å…¨å±€æ•°æ®ã€æ‰§è¡Œå†å²ç­‰ã€‚

### è¡¨è¾¾å¼ (Expression)

ä½¿ç”¨ `{{ }}` è¯­æ³•çš„è¡¨è¾¾å¼ï¼Œç”¨äºæ•°æ®ç»‘å®šå’ŒåŠ¨æ€è®¡ç®—ã€‚

### ç™½åå• (Whitelist)

å®‰å…¨æœºåˆ¶ï¼Œé™åˆ¶å¯æ‰§è¡Œçš„ Yao Processã€‚

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹ [DSL è¯­æ³•](./dsl.md) äº†è§£é…ç½®æ–¹æ³•
- é˜…è¯» [èŠ‚ç‚¹ç±»å‹](./nodes.md) äº†è§£å„ç§èŠ‚ç‚¹åŠŸèƒ½
- å‚è€ƒ [ç¤ºä¾‹ä»£ç ](./examples.md) æŸ¥çœ‹å®é™…åº”ç”¨
