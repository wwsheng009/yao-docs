# Yao 应用外部插件

使用插件机制可以在不修改 Yao 源码的情况下，实现一些增强功能。

## 插件机制

在 Yao 主程序中通过使用 grpc 的方式调用外部插件。grpc 的调用过程经过封装后，插件开发者不需要完整实现整个 grpc 的处理过程，只需要在外部插件的 main.go 中实现插件的处理逻辑即可。在插件的功能会暴露成 Yao 的处理器接口。

版本要求：0.10.3 及以上

## 插件目录设置

在最新的 0.10.3 版本代码中，可以在环境变量或是配置文件中指定插件的外部目录，可以在多个项目中共用同一个插件。

环境变量配置项：`YAO_EXTENSION_ROOT`

```go
type Config struct {
	ExtensionRoot string   `json:"extension_root,omitempty" env:"YAO_EXTENSION_ROOT" envDefault:""` // Plugin, Wasm root PATH, Default is <YAO_ROOT> (<YAO_ROOT>/plugins <YAO_ROOT>/wasms)
}
```

比如需要创建一个名称为 plugin1 的插件,假设这个插件目录结构如下：

```sh
Home
└─ yao
	└─ projects
		└─ ExtensionRoot		// 插件主目录
			└─ plugins			// 必须的目录
				└─ plugin1		// 插件目录
					├── main.go // 插件入口
					└── go.mod  // 插件配置文件

```

需要在`.env`文件中设置环境变量 YAO_EXTENSION_ROOT，指向插件目录。如果配置值为空，即是使用 yao 应用的目录。

```sh
YAO_EXTENSION_ROOT="/Home/yao/projects/ExtensionRoot"
```

## 插件模板

golang 插件请参考[插件模板](./golang%20grpc%20%E6%8F%92%E4%BB%B6%E6%A8%A1%E6%9D%BF.md)

更多的示例：

[在插件中实现 http 请求](https://github.com/wwsheng009/yao-chatgpt/tree/main/plugins/httpx)

[在插件中调用外部命令](https://github.com/wwsheng009/yao-plugin-command)

[飞书登录验证](./飞书自定义登录.md)

## 调用插件中的功能函数

```sh
yao run plugins.xx.xx

```

## 注意

不要在插件中使用 `fmt.Println` 函数，否则插件会调用失败。
