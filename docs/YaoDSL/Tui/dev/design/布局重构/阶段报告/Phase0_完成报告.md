# Phase 0: å‡†å¤‡é˜¶æ®µå®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2026å¹´1æœˆ22æ—¥
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æ‰§è¡Œæ—¶é—´**: 40 åˆ†é’Ÿ

---

## ğŸ“‹ ä»»åŠ¡å®Œæˆæƒ…å†µ

### âœ… 1. åˆ›å»ºç›®å½•ç»“æ„

æ‰€æœ‰è®¡åˆ’ä¸­çš„ç›®å½•å·²æˆåŠŸåˆ›å»ºï¼š

```
tui/
â”œâ”€â”€ runtime/              âœ… æ–°å»º
â”‚   â”œâ”€â”€ layout/          âœ… æ–°å»º
â”‚   â”œâ”€â”€ render/          âœ… æ–°å»º
â”‚   â”œâ”€â”€ event/           âœ… æ–°å»º
â”‚   â””â”€â”€ focus/           âœ… æ–°å»º
â”œâ”€â”€ ui/                  âœ… æ–°å»º
â”‚   â”œâ”€â”€ components/      âœ… æ–°å»º
â”‚   â”œâ”€â”€ layouts/         âœ… æ–°å»º
â”‚   â””â”€â”€ dsl/             âœ… æ–°å»º
â”œâ”€â”€ legacy/              âœ… æ–°å»º
â”‚   â””â”€â”€ layout/          âœ… ä» tui/layout/ ç§»åŠ¨åˆ°æ­¤
â””â”€â”€ tea/                 âœ… æ–°å»º
    â””â”€â”€ scripts/         âœ… æ–°å»ºè¾¹ç•Œæ£€æŸ¥è„šæœ¬
```

**éªŒè¯å‘½ä»¤**:

```bash
ls -la E:/projects/yao/wwsheng009/yao/tui/{runtime,ui,legacy,tea}
```

---

### âœ… 2. æ‹·è´å¹¶å†»ç»“è®¾è®¡æ–‡æ¡£

#### `tui/runtime/README.md`

- âœ… ä» `ui-runtime.md` æå–æ ¸å¿ƒå†…å®¹
- âœ… æ˜ç¡® v1 åŠŸèƒ½èŒƒå›´å’Œç¦æ­¢é¡¹
- âœ… å®šä¹‰ API å†»ç»“è§„åˆ™
- âœ… åŒ…å«ä¸‰é˜¶æ®µæ¸²æŸ“æ¨¡å‹å®Œæ•´è¯´æ˜
- âœ… åŒ…å«å¸¸è§é”™è¯¯å’Œåæ¨¡å¼ç¤ºä¾‹

**å…³é”®ç« èŠ‚**:

- è®¾è®¡ç›®æ ‡
- æ ¸å¿ƒè®¾è®¡åŸåˆ™
- æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆv1 å†»ç»“ï¼‰
- ä¸‰é˜¶æ®µæ¸²æŸ“æµç¨‹
- Flexbox ç®—æ³•
- è™šæ‹Ÿç”»å¸ƒ
- æ¨¡å—è¾¹ç•Œï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰
- API å†»ç»“è§„åˆ™

---

### âœ… 3. åˆ›å»º `tui/runtime/CONTRIBUTING.md`

- âœ… å®šä¹‰è´¡çŒ®æŒ‡å—
- âœ… æ˜ç¡®æ¨¡å—è¾¹ç•Œè§„åˆ™
- âœ… æµ‹è¯•è¦æ±‚ï¼ˆ>90% è¦†ç›–ç‡ï¼‰
- âœ… ä»£ç å®¡æŸ¥æ¸…å•
- âœ… å¸¸è§é”™è¯¯æ¨¡å¼
- âœ… æäº¤æµç¨‹

**å…³é”®ç« èŠ‚**:

- å¼€å‘å‰å¿…è¯»
- ä¿®æ”¹å‡†åˆ™
- æµ‹è¯•è¦æ±‚
- ä»£ç å®¡æŸ¥æ¸…å•
- å¸¸è§é”™è¯¯æ¨¡å¼
- æäº¤æµç¨‹

---

### âœ… 4. åˆ›å»º `tui/MODULE_BOUNDARIES.md`

- âœ… å®šä¹‰æ‰€æœ‰å±‚ä¹‹é—´çš„è¾¹ç•Œ
- âœ… æ˜ç¡®æ¯å±‚çš„èŒè´£
- âœ… åˆ—å‡ºå…è®¸å’Œç¦æ­¢çš„æ“ä½œ
- âœ… æä¾›è¾¹ç•Œè¿è§„æ£€æµ‹æ–¹æ³•
- âœ… åŒ…å«è·¨å±‚è°ƒç”¨è§„åˆ™

**å…³é”®ç« èŠ‚**:

- æ¶æ„æ¦‚è§ˆï¼ˆå›¾è¡¨ï¼‰
- Runtime å±‚èŒè´£å’Œè¾¹ç•Œ
- UI å±‚èŒè´£å’Œè¾¹ç•Œ
- Tea å±‚èŒè´£å’Œè¾¹ç•Œ
- Legacy å±‚èŒè´£å’Œè¾¹ç•Œ
- å…è®¸/ç¦æ­¢çš„è°ƒç”¨æ–¹å‘

---

### âœ… 5. è¾¹ç•Œè¿è§„æ£€æµ‹è„šæœ¬

#### `tui/scripts/check-boundaries.sh`

**åŠŸèƒ½**:

- âœ… æ£€æŸ¥ Runtime æ˜¯å¦ä¾èµ– Bubble Tea
- âœ… æ£€æŸ¥ Runtime æ˜¯å¦ä¾èµ– UI å±‚
- âœ… æ£€æŸ¥ Runtime æ˜¯å¦ä¾èµ–å…·ä½“ç»„ä»¶
- âœ… æ£€æŸ¥ Runtime æ˜¯å¦ä¾èµ– Legacy
- âœ… æ£€æŸ¥ render/ ä»¥å¤–çš„æ¨¡å—æ˜¯å¦ä½¿ç”¨ lipgloss
- âœ… æ£€æŸ¥ UI å±‚çš„æ½œåœ¨å¸ƒå±€ç®—æ³•å®ç°
- âœ… æ£€æŸ¥ Tea å±‚å¤æ‚åº¦

**è¿è¡Œç»“æœ**:

```
âœ… PASS: No Bubble Tea imports in Runtime
âœ… PASS: No UI layer imports in Runtime
âœ… PASS: No component imports in Runtime
âœ… PASS: No layout component imports in Runtime
âœ… PASS: No Legacy imports in Runtime
âœ… PASS: lipgloss only used in render/ module
âš ï¸  WARNING: UI layer may contain layout algorithm implementations
```

æ‰€æœ‰è¾¹ç•Œæ£€æŸ¥é€šè¿‡ï¼

---

### âœ… 6. Legacy å¸ƒå±€å¼•æ“è¿ç§»

#### è¿ç§»æ“ä½œ

- âœ… å°† `tui/layout/` ç§»åŠ¨åˆ° `tui/legacy/layout/`
- âœ… æ›´æ–° `shrink_test.go` ä¸­çš„ import è·¯å¾„
- âœ… éªŒè¯æµ‹è¯•é€šè¿‡ï¼ˆ`TestLayoutWithShrink` PASSEDï¼‰

**éªŒè¯å‘½ä»¤**:

```bash
go test ./tui/legacy/layout -v -run TestLayoutWithShrink
```

---

## ğŸ“Š ç›®å½•ç»“æ„ç¡®è®¤

```
tui/
â”œâ”€â”€ runtime/
â”‚   â”œâ”€â”€ README.md              (æ–°å»º - 438 è¡Œ)
â”‚   â”œâ”€â”€ CONTRIBUTING.md        (æ–°å»º - 286 è¡Œ)
â”‚   â”œâ”€â”€ layout/                (ç©º - å¾…å®ç°)
â”‚   â”œâ”€â”€ render/                (ç©º - å¾…å®ç°)
â”‚   â”œâ”€â”€ event/                 (ç©º - å¾…å®ç°)
â”‚   â””â”€â”€ focus/                 (ç©º - å¾…å®ç°)
â”‚
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ components/            (ç©º - å¾…è¿ç§»)
â”‚   â”œâ”€â”€ layouts/               (ç©º - å¾…å®ç°)
â”‚   â””â”€â”€ dsl/                   (ç©º - å¾…å®ç°)
â”‚
â”œâ”€â”€ legacy/
â”‚   â””â”€â”€ layout/                (å·²è¿ç§» - 9 ä¸ªæ–‡ä»¶)
â”‚       â”œâ”€â”€ builder.go
â”‚       â”œâ”€â”€ builder_test.go
â”‚       â”œâ”€â”€ engine.go
â”‚       â”œâ”€â”€ engine_test.go
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ tea/                       (ç©º - å¾…å®ç°)
â”‚
â””â”€â”€ scripts/
    â””â”€â”€ check-boundaries.sh    (æ–°å»º - è¾¹ç•Œæ£€æŸ¥è„šæœ¬)
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### Legacy æµ‹è¯•é€šè¿‡

```bash
$ go test ./tui/legacy/layout -v -run TestLayoutWithShrink
=== RUN   TestLayoutWithShrink
[Layout] layoutFlex called: node=root, container: 100x30
[Layout]   available=100, shrinkSum=2, growSum=2
--- PASS: TestLayoutWithShrink (0.00s)
PASS
ok      github.com/yaoapp/yao/tui/legacy/layout    1.620s
```

### è¾¹ç•Œæ£€æŸ¥é€šè¿‡

```bash
$ bash tui/scripts/check-boundaries.sh
âœ… PASS: No Bubble Tea imports in Runtime
âœ… PASS: No UI layer imports in Runtime
âœ… PASS: No component imports in Runtime
âœ… PASS: No layout component imports in Runtime
âœ… PASS: No Legacy imports in Runtime
âœ… PASS: lipgloss only used in render/ module
âœ… PASSED: All boundary checks passed!
```

---

## ğŸ“ å¾…åŠäº‹é¡¹ï¼ˆä¸‹ä¸€é˜¶æ®µï¼‰

### Phase 1: æœ€å° Runtime å·¥ä½œï¼ˆ1å‘¨ï¼‰

#### ä»»åŠ¡æ¸…å•ï¼ˆå…± 22 é¡¹ï¼‰

1. **æ ¸å¿ƒæ•°æ®ç»“æ„** - 4 é¡¹
   - [ ] å®ç° `runtime.LayoutNode`ï¼ˆä¸ legacy ä¿æŒå…¼å®¹ï¼‰
   - [ ] å®ç° `runtime.BoxConstraints` ç³»ç»Ÿ
   - [ ] å®ç° `runtime.Style`ï¼ˆv1 ç®€åŒ–ç‰ˆï¼‰
   - [ ] å®šä¹‰ `runtime.Measurable` æ¥å£

2. **ä¸‰é˜¶æ®µå¼•æ“** - 4 é¡¹
   - [ ] å®ç° `runtime.Runtime` æ¥å£
   - [ ] å®ç° `measure` é˜¶æ®µ
   - [ ] å®ç° `layout` é˜¶æ®µ
   - [ ] å®ç° `render` é˜¶æ®µ

3. **è™šæ‹Ÿç”»å¸ƒ** - 3 é¡¹
   - [ ] å®ç° `render.CellBuffer` æ”¯æŒ Z-Index
   - [ ] å®ç°åŸºç¡€ `render.Renderer` è¾“å‡º Frame
   - [ ] å®ç° `Frame.String()` æ–¹æ³•

4. **Text ç»„ä»¶é€‚é…** - 4 é¡¹
   - [ ] åˆ›å»º `ui/components/text.go`
   - [ ] é€‚é…ç°æœ‰ Text ç»„ä»¶
   - [ ] æµ‹è¯• Text ç»„ä»¶
   - [ ] é›†æˆæµ‹è¯•

5. **é›†æˆæµ‹è¯•** - 4 é¡¹
   - [ ] åˆ›å»ºç«¯åˆ°ç«¯æµ‹è¯•
   - [ ] éªŒè¯ä¸‰é˜¶æ®µåˆ†ç¦»
   - [ ] ç¡®ä¿ç°æœ‰æµ‹è¯•ä¸ç ´å
   - [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ”‘ å…³é”®æˆæœ

### 1. åŸºç¡€è®¾æ–½å»ºç«‹

- âœ… å®Œæ•´çš„ç›®å½•ç»“æ„
- âœ… æ¨¡å—è¾¹ç•Œå®šä¹‰å’Œå¼ºåˆ¶æ‰§è¡Œ
- âœ… æ–‡æ¡£ä½“ç³»å»ºç«‹

### 2. è¾¹ç•Œä¿æŠ¤æœºåˆ¶

- âœ… è‡ªåŠ¨åŒ–è¾¹ç•Œæ£€æŸ¥è„šæœ¬
- âœ… ä¸¥æ ¼çš„ä¾èµ–è§„åˆ™å®šä¹‰
- âœ… æ¸…æ™°çš„è¿ååæœè¯´æ˜

### 3. çŸ¥è¯†ä¼ æ‰¿

- âœ… å®Œæ•´çš„ API æ–‡æ¡£
- âœ… è´¡çŒ®æŒ‡å—
- âœ… é”™è¯¯æ¨¡å¼å‚è€ƒ

### 4. ç°æœ‰ç³»ç»Ÿä¿æŠ¤

- âœ… Legacy ä»£ç æ— æŸè¿ç§»
- âœ… æµ‹è¯•ä¿æŒé€šè¿‡
- âœ… å…¼å®¹æ€§ä¿è¯

---

## ğŸš€ ä¸‹ä¸€é˜¶æ®µé‡ç‚¹

### ç«‹å³å¼€å§‹

å»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¼€å§‹ Phase 1ï¼š

1. **ç¬¬ä¸€æ­¥**ï¼šå®ç° `runtime/types.go`ï¼ˆæ ¸å¿ƒæ•°æ®ç»“æ„ï¼‰
2. **ç¬¬äºŒæ­¥**ï¼šå®ç° `runtime/layout/constraints.go`ï¼ˆçº¦æŸç³»ç»Ÿï¼‰
3. **ç¬¬ä¸‰æ­¥**ï¼šå®ç° `runtime/layout/measure.go`ï¼ˆæµ‹é‡é˜¶æ®µï¼‰
4. **ç¬¬å››æ­¥**ï¼šå®ç° `runtime/runtime.go`ï¼ˆRuntime æ¥å£ï¼‰

### æŠ€æœ¯å‚è€ƒ

é‡åˆ°æŠ€æœ¯é—®é¢˜æ—¶ï¼Œæœç´¢ `E:/projects/yao/wwsheng009/yao/tui/docs/design/å¸ƒå±€é‡æ„`:

- `ui-runtime.md` - æ ¸å¿ƒè®¾è®¡æ–‡æ¡£
- `TODO.md` - å®æ–½è®¡åˆ’
- `é‡æ„æ–¹æ¡ˆ.md` - æŠ€æœ¯ç»†èŠ‚
- `STEP1.md` ~ `STEP5.md` - åˆ†æ­¥æŒ‡å¯¼

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»éµå®ˆæ¨¡å—è¾¹ç•Œ**ï¼šRuntime ä¸èƒ½ä¾èµ– UIã€Teaã€Legacy
2. **ä¿æŒæ–‡æ¡£åŒæ­¥**ï¼šä»»ä½• API å˜æ›´å¿…é¡»æ›´æ–° `runtime/README.md`
3. **æµ‹è¯•å…ˆè¡Œ**ï¼šä»»ä½•ä»£ç å¿…é¡»æœ‰å¯¹åº”æµ‹è¯•
4. **æ€§èƒ½ç›‘æ§**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½è¦è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•

---

**Phase 0 å®Œæˆæ—¶é—´**: 2026å¹´1æœˆ22æ—¥ 14:35
**ä¸‹ä¸€é˜¶æ®µå¯åŠ¨**: Phase 1: æœ€å° Runtime å·¥ä½œï¼ˆé¢„è®¡ 1 å‘¨ï¼‰
**æ‰¹å‡†äºº**: [å¾…è¡¥å……]
