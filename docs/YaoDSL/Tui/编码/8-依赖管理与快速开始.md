# TUI ä¾èµ–ç®¡ç†ä¸å¿«é€Ÿå¼€å§‹æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› TUI å¼•æ“çš„å®Œæ•´ä¾èµ–æ¸…å•ã€å®‰è£…æ­¥éª¤å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—ï¼Œç¡®ä¿å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ã€‚

---

## 1. ä¾èµ–é¡¹æ¸…å•

### 1.1 Go æ¨¡å—ä¾èµ–

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `go.mod` ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```go
module github.com/yaoapp/yao

go 1.21

require (
    // Bubble Tea - TUI æ¡†æ¶æ ¸å¿ƒ
    github.com/charmbracelet/bubbletea v0.25.0

    // Lip Gloss - æ ·å¼ç³»ç»Ÿ
    github.com/charmbracelet/lipgloss v0.9.1

    // Bubbles - æ ‡å‡†ç»„ä»¶åº“
    github.com/charmbracelet/bubbles v0.17.1

    // Glamour - Markdown æ¸²æŸ“
    github.com/charmbracelet/glamour v0.6.0

    // V8Go - JavaScript è¿è¡Œæ—¶ï¼ˆå·²åœ¨ Yao ä¸­ï¼‰
    rogchap.com/v8go v0.9.0

    // Yao å†…éƒ¨ä¾èµ–ï¼ˆå·²å­˜åœ¨ï¼‰
    github.com/yaoapp/gou v0.0.0

    // æµ‹è¯•ä¾èµ–
    github.com/stretchr/testify v1.8.4
)
```

### 1.2 å®‰è£…ä¾èµ–å‘½ä»¤

```bash
# 1. ä¸‹è½½æ‰€æœ‰ä¾èµ–
go mod download

# 2. æ•´ç†ä¾èµ–ï¼ˆæ¸…ç†æœªä½¿ç”¨çš„ï¼‰
go mod tidy

# 3. éªŒè¯ä¾èµ–
go mod verify
```

### 1.3 ä¾èµ–ç‰ˆæœ¬é”å®š

```bash
# ç”Ÿæˆ go.sum æ–‡ä»¶é”å®šç‰ˆæœ¬
go mod download

# æ›´æ–°ç‰¹å®šä¾èµ–
go get github.com/charmbracelet/bubbletea@latest

# å›é€€åˆ°ç‰¹å®šç‰ˆæœ¬
go get github.com/charmbracelet/bubbletea@v0.25.0
```

---

## 2. å¼€å‘ç¯å¢ƒè®¾ç½®

### 2.1 å¿…éœ€å·¥å…·

```bash
# 1. Go ç‰ˆæœ¬è¦æ±‚
go version  # éœ€è¦ >= 1.21

# 2. Gitï¼ˆç”¨äº go modulesï¼‰
git version

# 3. Makeï¼ˆç”¨äºæ„å»ºè„šæœ¬ï¼‰
make --version

# 4. golangci-lintï¼ˆä»£ç æ£€æŸ¥ï¼‰
curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.55.2
```

### 2.2 IDE é…ç½®

#### VS Code é…ç½® (`.vscode/settings.json`)

```json
{
  "go.useLanguageServer": true,
  "go.lintTool": "golangci-lint",
  "go.lintOnSave": "workspace",
  "go.testFlags": ["-v", "-race"],
  "go.buildTags": "integration",
  "[go]": {
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
      "source.organizeImports": true
    }
  },
  "go.testTimeout": "60s"
}
```

#### GoLand é…ç½®

```
Settings > Go > Build Tags & Vendoring
- Build Tags: integration

Settings > Go > Go Modules
- Enable Go modules integration: âœ“
- Vendoring mode: âœ—

Settings > Tools > File Watchers
- Add Go fmt watcher
- Add goimports watcher
```

---

## 3. é¡¹ç›®ç»“æ„åˆå§‹åŒ–

### 3.1 ç›®å½•ç»“æ„

```bash
# åœ¨ Yao é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
mkdir -p tui
mkdir -p tui/components
mkdir -p tui/mock
mkdir -p tuis
mkdir -p scripts/tui

# åˆ›å»ºæ ¸å¿ƒæ–‡ä»¶
touch tui/types.go
touch tui/loader.go
touch tui/driver.go
touch tui/model.go
touch tui/action.go
touch tui/render.go
touch tui/script.go
touch tui/jsapi.go
touch tui/process.go
touch tui/theme.go
touch tui/metrics.go

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
touch tui/tui_test.go
touch tui/loader_test.go
touch tui/model_test.go
touch tui/action_test.go
```

### 3.2 ç›®å½•æƒé™è®¾ç½®

```bash
# Linux/macOS
chmod -R 755 tui/
chmod -R 755 tuis/
chmod -R 755 scripts/tui/

# Windows (PowerShell)
icacls tui /grant Users:F /T
icacls tuis /grant Users:F /T
```

---

## 4. å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

### 4.1 åˆ›å»ºç¬¬ä¸€ä¸ª TUIï¼ˆ5åˆ†é’Ÿæ•™ç¨‹ï¼‰

#### æ­¥éª¤ 1: åˆ›å»ºé…ç½®æ–‡ä»¶

```json
// tuis/hello.tui.yao
{
  "name": "Hello TUI",
  "data": {
    "title": "Hello Yao TUI!",
    "message": "Welcome to terminal UI"
  },
  "layout": {
    "direction": "vertical",
    "children": [
      {
        "type": "header",
        "props": {
          "title": "{{title}}"
        }
      },
      {
        "type": "text",
        "props": {
          "content": "{{message}}"
        }
      }
    ]
  },
  "bindings": {
    "q": {
      "process": "tui.Quit"
    }
  }
}
```

#### æ­¥éª¤ 2: å¯åŠ¨åº”ç”¨

```bash
# æ–¹æ³• 1: ç›´æ¥è¿è¡Œ
yao tui hello

# æ–¹æ³• 2: ä½¿ç”¨ make
make run-tui ID=hello

# æ–¹æ³• 3: å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
yao tui hello --watch
```

#### æ­¥éª¤ 3: éªŒè¯ç»“æœ

é¢„æœŸçœ‹åˆ°ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Hello Yao TUI!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Welcome to terminal UI

Press 'q' to quit
```

---

## 5. å®Œæ•´ç¤ºä¾‹ï¼šå¸¦è„šæœ¬çš„ TUI

### 5.1 é…ç½®æ–‡ä»¶

```json
// tuis/counter.tui.yao
{
  "name": "Counter Demo",
  "data": {
    "count": 0,
    "message": "Click + or - to change"
  },
  "layout": {
    "direction": "vertical",
    "children": [
      {
        "type": "header",
        "props": {
          "title": "Counter: {{count}}"
        }
      },
      {
        "type": "text",
        "props": {
          "content": "{{message}}"
        }
      }
    ]
  },
  "bindings": {
    "+": {
      "script": "scripts/tui/counter",
      "method": "increment"
    },
    "-": {
      "script": "scripts/tui/counter",
      "method": "decrement"
    },
    "r": {
      "script": "scripts/tui/counter",
      "method": "reset"
    },
    "q": {
      "process": "tui.Quit"
    }
  }
}
```

### 5.2 è„šæœ¬å®ç°

```typescript
// scripts/tui/counter.ts

/**
 * Counter TUI Script
 */

// å¢åŠ è®¡æ•°
function increment(tui: any) {
  const count = tui.GetState('count') || 0;
  tui.SetState('count', count + 1);
  tui.SetState('message', `Count increased to ${count + 1}`);
}

// å‡å°‘è®¡æ•°
function decrement(tui: any) {
  const count = tui.GetState('count') || 0;
  tui.SetState('count', count - 1);
  tui.SetState('message', `Count decreased to ${count - 1}`);
}

// é‡ç½®è®¡æ•°
function reset(tui: any) {
  tui.SetState('count', 0);
  tui.SetState('message', 'Counter reset to 0');
}
```

### 5.3 è¿è¡Œç¤ºä¾‹

```bash
# å¯åŠ¨ counter TUI
yao tui counter

# æ“ä½œè¯´æ˜
# + : å¢åŠ è®¡æ•°
# - : å‡å°‘è®¡æ•°
# r : é‡ç½®
# q : é€€å‡º
```

---

## 6. AI èŠå¤©ç¤ºä¾‹

### 6.1 é…ç½®æ–‡ä»¶

```json
// tuis/chat.tui.yao
{
  "name": "AI Chat Terminal",
  "data": {
    "history": [],
    "input": "",
    "loading": false
  },
  "layout": {
    "direction": "vertical",
    "children": [
      {
        "type": "header",
        "props": {
          "title": "ğŸ’¬ Yao AI Chat"
        }
      },
      {
        "type": "viewport",
        "bind": "history",
        "props": {
          "height": "flex",
          "render": "markdown"
        }
      },
      {
        "type": "input",
        "props": {
          "placeholder": "Type your message...",
          "value": "{{input}}"
        },
        "onEnter": {
          "script": "scripts/tui/chat",
          "method": "sendMessage"
        }
      },
      {
        "type": "footer",
        "props": {
          "text": "Press Ctrl+C to exit"
        }
      }
    ]
  }
}
```

### 6.2 è„šæœ¬å®ç°

```typescript
// scripts/tui/chat.ts

/**
 * AI Chat Handler
 */

function sendMessage(tui: any, message: string) {
  if (!message.trim()) {
    return;
  }

  // è·å–å†å²è®°å½•
  const history = tui.GetState('history') || [];

  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  history.push({
    role: 'user',
    content: message
  });

  // æ›´æ–°çŠ¶æ€
  tui.UpdateState({
    history: history,
    input: '',
    loading: true
  });

  // è°ƒç”¨ AIï¼ˆå¼‚æ­¥ï¼‰
  tui.ExecuteAction({
    process: 'aigc.chat.Stream',
    args: [
      {
        model: 'gpt-4',
        messages: history
      }
    ],
    onSuccess: 'ai_response',
    onError: 'ai_error'
  });
}

function handleAIChunk(tui: any, chunk: string) {
  const history = tui.GetState('history') || [];
  const lastMessage = history[history.length - 1];

  if (lastMessage && lastMessage.role === 'assistant') {
    lastMessage.content += chunk;
  } else {
    history.push({
      role: 'assistant',
      content: chunk
    });
  }

  tui.SetState('history', history);
}

function handleAIComplete(tui: any) {
  tui.SetState('loading', false);
}
```

---

## 7. è°ƒè¯•æŠ€å·§

### 7.1 å¯ç”¨è°ƒè¯•æ¨¡å¼

```bash
# ç¯å¢ƒå˜é‡æ–¹å¼
export YAO_TUI_DEBUG=true
yao tui hello

# å‘½ä»¤è¡Œå‚æ•°æ–¹å¼
yao tui hello --debug

# æ—¥å¿—çº§åˆ«
yao tui hello --log-level=debug
```

### 7.2 æŸ¥çœ‹çŠ¶æ€

```typescript
// åœ¨è„šæœ¬ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
function debugState(tui: any) {
  console.log('Current State:', JSON.stringify(tui.GetState(), null, 2));
}
```

### 7.3 æ€§èƒ½åˆ†æ

```bash
# CPU åˆ†æ
go test ./tui/... -cpuprofile=cpu.prof -bench=.
go tool pprof cpu.prof

# å†…å­˜åˆ†æ
go test ./tui/... -memprofile=mem.prof -bench=.
go tool pprof mem.prof

# ç«æ€æ£€æµ‹
go test ./tui/... -race
```

---

## 8. å¸¸è§é—®é¢˜è§£å†³

### 8.1 ä¾èµ–é—®é¢˜

**é—®é¢˜**: `go.mod` ä¾èµ–å†²çª

```bash
# è§£å†³æ–¹æ¡ˆ
go mod tidy
go mod download
go clean -modcache  # æ¸…ç†ç¼“å­˜
go mod download     # é‡æ–°ä¸‹è½½
```

**é—®é¢˜**: V8Go ç¼–è¯‘å¤±è´¥

```bash
# ç¡®ä¿å®‰è£…äº† CGO ä¾èµ–
# Ubuntu/Debian
sudo apt-get install build-essential

# macOS
xcode-select --install

# è®¾ç½® CGO ç¯å¢ƒå˜é‡
export CGO_ENABLED=1
```

### 8.2 è¿è¡Œæ—¶é—®é¢˜

**é—®é¢˜**: TUI æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
yao tui hello --validate

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
yao tui hello --verbose

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la tuis/hello.tui.yao
```

**é—®é¢˜**: è„šæœ¬æ‰§è¡Œå¤±è´¥

```bash
# æ£€æŸ¥è„šæœ¬è¯­æ³•
yao script validate scripts/tui/chat.ts

# æŸ¥çœ‹ V8 æ—¥å¿—
export V8_DEBUG=true
yao tui chat
```

### 8.3 æ€§èƒ½é—®é¢˜

**é—®é¢˜**: æ¸²æŸ“å¡é¡¿

```go
// æ£€æŸ¥æ¸²æŸ“æ€§èƒ½
go test ./tui/... -bench=BenchmarkRenderLayout -benchmem

// ä¼˜åŒ–å»ºè®®ï¼š
// 1. å‡å°‘ç»„ä»¶æ•°é‡
// 2. ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨
// 3. å¯ç”¨æ¸²æŸ“ç¼“å­˜
```

**é—®é¢˜**: å†…å­˜å ç”¨è¿‡é«˜

```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
yao tui hello --metrics

# æ£€æŸ¥å†…å­˜æ³„æ¼
go test ./tui/... -memprofile=mem.prof
go tool pprof -http=:8080 mem.prof
```

---

## 9. å¼€å‘å·¥ä½œæµ

### 9.1 æ ‡å‡†å¼€å‘æµç¨‹

```bash
# 1. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
git checkout -b feature/tui-new-component

# 2. å¼€å‘ä»£ç 
vim tui/components/new_component.go

# 3. ç¼–å†™æµ‹è¯•
vim tui/components/new_component_test.go

# 4. è¿è¡Œæµ‹è¯•
make test-tui

# 5. ä»£ç æ£€æŸ¥
make lint-tui

# 6. æäº¤ä»£ç 
git add .
git commit -m "feat(tui): add new component"

# 7. æ¨é€å¹¶åˆ›å»º PR
git push origin feature/tui-new-component
```

### 9.2 çƒ­é‡è½½å¼€å‘

```bash
# ä½¿ç”¨ air æˆ– nodemon å®ç°çƒ­é‡è½½

# å®‰è£… air
go install github.com/cosmtrek/air@latest

# åˆ›å»ºé…ç½®æ–‡ä»¶ .air.toml
cat > .air.toml <<EOF
root = "."
[build]
  cmd = "make build"
  bin = "dist/yao"
  include_ext = ["go", "tpl", "tmpl", "html", "yaml", "json"]
  exclude_dir = ["tmp", "vendor", "dist"]
EOF

# å¯åŠ¨çƒ­é‡è½½
air tui hello
```

---

## 10. éƒ¨ç½²æ£€æŸ¥æ¸…å•

### 10.1 å‘å¸ƒå‰æ£€æŸ¥

```bash
# âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡
make test-tui

# âœ“ ä»£ç æ£€æŸ¥é€šè¿‡
make lint-tui

# âœ“ æ€§èƒ½åŸºå‡†è¾¾æ ‡
make bench-tui

# âœ“ æ–‡æ¡£å®Œæ•´
ls -la tui/*.md

# âœ“ ç¤ºä¾‹å¯è¿è¡Œ
yao tui hello
yao tui counter
yao tui chat

# âœ“ ä¾èµ–ç‰ˆæœ¬é”å®š
cat go.sum | grep bubbletea

# âœ“ ç‰ˆæœ¬å·æ›´æ–°
vim share/const.go  # æ›´æ–° TUI ç‰ˆæœ¬å·
```

### 10.2 æ„å»ºå‘å¸ƒ

```bash
# 1. æ¸…ç†æ„å»ºç¼“å­˜
make clean

# 2. è¿è¡Œå®Œæ•´æµ‹è¯•
make test

# 3. æ„å»ºäºŒè¿›åˆ¶
make release

# 4. éªŒè¯æ„å»º
dist/yao version
dist/yao tui hello

# 5. æ‰“åŒ…å‘å¸ƒ
make artifacts
```

---

## 11. å­¦ä¹ èµ„æº

### 11.1 å®˜æ–¹æ–‡æ¡£

- [Bubble Tea æ–‡æ¡£](https://github.com/charmbracelet/bubbletea)
- [Lip Gloss æ ·å¼æŒ‡å—](https://github.com/charmbracelet/lipgloss)
- [Yao æ–‡æ¡£](https://yaoapps.com/doc)

### 11.2 ç¤ºä¾‹é¡¹ç›®

```bash
# å…‹éš†ç¤ºä¾‹ä»“åº“
git clone https://github.com/charmbracelet/bubbletea-examples
cd bubbletea-examples

# è¿è¡Œç¤ºä¾‹
go run examples/hello-world/main.go
go run examples/chat/main.go
```

### 11.3 è§†é¢‘æ•™ç¨‹

- Bubble Tea å…¥é—¨ (YouTube)
- Yao TUI å¼€å‘å®æˆ˜ (Bç«™)
- V8Go é›†æˆæŒ‡å— (YouTube)

---

## 12. è·å–å¸®åŠ©

### 12.1 ç¤¾åŒºæ”¯æŒ

- GitHub Issues: https://github.com/yaoapp/yao/issues
- Discord: https://discord.gg/yao
- è®ºå›: https://forum.yaoapps.com

### 12.2 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# å¼€å‘
yao tui <id>                  # è¿è¡Œ TUI
yao tui <id> --debug          # è°ƒè¯•æ¨¡å¼
yao tui <id> --watch          # çƒ­é‡è½½

# æµ‹è¯•
make test-tui                 # å•å…ƒæµ‹è¯•
make bench-tui                # æ€§èƒ½æµ‹è¯•
make lint-tui                 # ä»£ç æ£€æŸ¥

# æ„å»º
make build                    # å¼€å‘æ„å»º
make release                  # å‘å¸ƒæ„å»º
make clean                    # æ¸…ç†

# å·¥å…·
yao tui validate <id>         # éªŒè¯é…ç½®
yao tui list                  # åˆ—å‡ºæ‰€æœ‰ TUI
yao tui metrics               # æŸ¥çœ‹æŒ‡æ ‡
```

---

## æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… å®‰è£…æ‰€æœ‰å¿…éœ€ä¾èµ–
2. âœ… é…ç½®å¼€å‘ç¯å¢ƒ
3. âœ… åˆ›å»ºç¬¬ä¸€ä¸ª TUI åº”ç”¨
4. âœ… é›†æˆ JavaScript è„šæœ¬
5. âœ… è°ƒè¯•å’Œä¼˜åŒ–åº”ç”¨
6. âœ… éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**ä¸‹ä¸€æ­¥å»ºè®®**:

- é˜…è¯» API æ–‡æ¡£æ·±å…¥äº†è§£ç»„ä»¶ç³»ç»Ÿ
- ç ”ç©¶ç¤ºä¾‹é¡¹ç›®å­¦ä¹ æœ€ä½³å®è·µ
- åŠ å…¥ç¤¾åŒºè·å–å¸®åŠ©å’Œäº¤æµç»éªŒ

ç¥æ‚¨å¼€å‘æ„‰å¿«ï¼ğŸ‰
