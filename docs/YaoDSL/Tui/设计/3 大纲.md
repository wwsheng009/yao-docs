你好！我是 **Yao Dev**，高级代码开发工程师。

很高兴能继续深度参与到 Yao TUI 引擎的设计中。基于 Yao 的插件化架构和 DSL 驱动思想，结合 Bubble Tea 的事件循环模型，我为你制定了一份详尽的项目实施大纲。这份大纲将从**核心架构层**、**DSL 规范层**、**组件运行时**以及**工程化落地**四个维度展开。

---

### Yao TUI 项目实施大纲

#### 第一阶段：核心运行时与架构搭建 (Core Runtime)

本阶段目标是建立 TUI 在 Yao 引擎中的“合法身份”，实现 DSL 的加载与 Bubble Tea 的基础生命周期映射。

1. **目录结构定义**：

- 在根目录创建 `tui/` 文件夹。
- `tui/loader.go`：负责从 `tuis/` 目录递归加载 `.tui.yao` 文件，解析为内存结构并建立 ID 索引。
- `tui/driver.go`：封装 Bubble Tea 的 `tea.Model` 接口，定义 Yao 专有的 `Init`, `Update`, `View` 逻辑。

2. **Process 处理器集成**：

- 实现 `tui.Render(id, args)` 处理器，允许从 JS 或其他 DSL 启动 TUI 界面。
- 封装同步/异步 Process 调用工具函数，确保在 `Update` 函数中调用 Yao Process 时不会阻塞 UI 渲染（使用 `tea.Cmd` 模式）。

3. **基础 Model 设计 (`types.go`)**：

- 定义 `State` 结构：一个响应式的 `map[string]interface{}`，存储当前页面的所有变量。
- 定义 `Action` 结构：描述意图（Intent），如 `process`, `link`, `setState`, `quit`。

#### 第二阶段：DSL 解析引擎与数据绑定 (DSL & Binding)

本阶段解决 JSON 如何描述 UI 以及数据如何实时更新的问题。

1. **UI 描述规范**：

- 设计 `layout` 嵌套协议（支持 vertical, horizontal, stack）。
- 引入 `Component` 引用机制，支持通过 `{"type": "table", "props": {...}}` 实例化组件。

2. **表达式解析器 (`expression.go`)**：

- 复用 `pipe/expression.go` 的逻辑，支持在 JSON 属性中使用 `{{users.list}}` 语法。
- 实现**计算属性 (Computed Props)**：支持在 DSL 中定义简单的逻辑处理，类似于 Sui 的数据渲染。

3. **状态流转机制**：

- 实现 `SET_STATE` 消息，当 Process 返回数据后，自动更新 `State` 并触发 UI 刷新。
- 设计全局与局部的作用域隔离，确保子组件只能访问其被分配的数据片段。

#### 第三阶段：标准组件库开发 (Component Library)

基于 Lip Gloss 提供样式，基于 Bubble Tea 社区成熟组件封装 Yao 专用的 TUI 组件。

1. **容器类组件**：

- `Box/Container`：负责边框 (Border)、内边距 (Padding) 和样式映射。
- `Tabs`：多页面/多视图切换逻辑。

2. **数据交互组件**：

- `List/Table`：支持分页加载、行选中事件触发 Yao Process。
- `Form/Input`：支持文本框、选择框，将输入结果绑定回 `State`。
- `Viewport/Markdown`：用于显示长文本或 AI 生成的 Markdown 内容。

3. **AI 增强组件**：

- `Chat`：专为 AI 对话设计的终端组件，支持流式输出渲染。
- `Progress`：用于展示耗时任务（如模型训练或索引建立）的进度。

#### 第四阶段：命令集成与工程化 (CLI & Tooling)

将 TUI 正式集成到 Yao 的 CLI 工具链中，并提供开发者调试支持。

1. **CLI 命令实现**：

- 在 `cmd/` 下创建 `tui.go`，支持 `yao tui <ID> [Args...]`。
- 实现 `--debug` 模式，在界面侧边栏显示实时变量状态（State Monitor）。

2. **热加载 (Hot Reload)**：

- 监听 `tuis/` 目录的文件变更，当 .yao 文件修改时，自动重载内存配置并通知 TUI 程序刷新视图。

3. **案例与模板**：

- 提供 `login.tui.yao` (认证示例) 和 `dashboard.tui.yao` (监控示例)。
- 编写集成 AI 助手的 `chat.tui.yao`，展示 Process 如何调用 `aigc` 模块。

---

**关键建议：**
在实现过程中，建议优先攻克 **`Update` 循环中的并发安全** 问题。因为 Yao 的 Process 可能非常重（例如调用 LLM 接口），我们必须在 `tui` 包内实现一个消息队列，将 Process 执行结果封装为 `tea.Msg` 抛回给 Bubble Tea，以保证界面的丝滑度。

你是否希望我针对 **第一阶段中的 `tea.Model` 与 Yao Process 结合的具体代码实现** 给出第一版原型 demo？
