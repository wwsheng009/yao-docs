你好！我是 **Yao Dev**，一名深耕 Golang 领域的架构级开发工程师。

很高兴看到你提出为 Yao 引擎增加 TUI (Terminal User Interface) 功能的设计思路。将 Yao 强大的 **Process 处理器机制**与 **Bubble Tea** 优秀的终端交互能力结合，通过 **DSL (JSON/Yao) 驱动**来实现界面逻辑，这非常符合 Yao 的设计哲学。我已仔细审阅了你的初步方案，并结合 Yao 现有的 `pipe`、`sui` 等模块的实现逻辑，从架构深度、状态管理以及 DSL 规范化三个方面为你完善了这份设计文档。

你目前在实现 DSL 动态绑定状态数据，或者在处理 Bubble Tea 的并发消息循环（Update/Model/View）与 Yao Process 同步调用时，是否遇到了具体的阻塞或性能挑战？以下是我为你优化的详细设计建议。

### Yao TUI 核心架构方案

#### 1. 结构化 DSL 设计 (tuis/<id>.tui.yao)

为了防止单一界面配置文件过大，建议引入 **Layout (布局)**、**Component (组件)** 和 **Action (行为)** 的三层抽象。组件化设计允许跨页面复用。

```jsonc
{
  "name": "用户管理终端",
  "data": { "users": [], "selected": null }, // 初始状态数据
  "onLoad": "scripts.user.InitTUI", // 页面加载时触发的 Process
  "layout": {
    "direction": "vertical",
    "children": [
      { "component": "header", "props": { "text": "Yao Admin Terminal" } },
      {
        "id": "user_list",
        "component": "List",
        "props": { "items": "{{users}}", "height": 20 },
        "onSelect": {
          "process": "models.user.Find",
          "args": ["{{item.id}}"],
          "next": "SET_SELECTED" // 状态更新意图
        }
      }
    ]
  }
}
```

#### 2. 引擎内部实现逻辑 (tui/ 模块)

- **DSL 加载与解析 (`tui/tui.go`)**：参考 `pipe/pipe.go`，使用 `dsl.Register` 机制。在 `Load` 阶段解析 `{{}}` 表达式。建议集成 `github.com/yaoapp/gou/connector` 以支持 Process 动态调用。
- **状态机与数据绑定 (`tui/types.go`)**：Bubble Tea 的 `Model` 接口应持有一个 `map[string]interface{}` 作为 **State Store**。
- **建议**：使用 Yao 内部的 `yaoapp/yao/pipe/expression.go` 逻辑来实现 View 层的实时数据插值。每当 Process 返回数据，通过 `tea.Cmd` 发送消息更新 Store，并触发全局重绘。

- **组件抽象**：定义一个 `Component` 接口，封装 Bubble Tea 的 `Update` 和 `View` 方法，使得 `tui.go` 能够根据 JSON 类型实例化对应的内置组件（如 `List`、`Table`、`Form`、`Viewport`）。

#### 3. 进程间通信与 Process 集成

- **同步/异步调用**：在 Bubble Tea 的 `Update(msg)` 中调用 `Process.Of(name, args)`。对于耗时的 I/O 操作（如 AI 接口调用），必须封装在 `tea.Cmd` 中异步执行，避免阻塞 UI 线程。
- **内置 Action 意图**：在 DSL 中预定义行为，例如 `"action": "navigation.Push"` 或 `"action": "state.Set"`，减少开发者编写 JS 脚本的负担。

#### 4. 命令行交互 (cmd/tui.go)

参考 `cmd/sui/build.go`，增加 `yao tui <ID> [Args]` 命令。

- **建议**：支持终端自适应。通过 `tea.WithAltScreen()` 进入全屏模式，并在程序退出时利用 Yao 的 `defer` 机制清理终端上下文。对于 `yao tui login` 这种敏感操作，可以通过 `Process` 安全地获取环境变量中的凭证。

这份完善后的方案能够确保 TUI 模块在 Yao 框架下具有高度的可扩展性。你是否需要我针对 **DSL 解析器如何注入全局样式 (Lip Gloss)** 或者 **子组件状态同步隔离** 的代码实现细节提供进一步的参考代码？
