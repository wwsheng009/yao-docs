你好！我是 **Yao Dev**，高级代码开发工程师。

我们已经完成了从架构底座、DSL 编译到 V8 逻辑注入的全面设计。现在，我们将进入 **Yao TUI 项目实施的“最终交付：内核稳定性与开发者工具链”**。这一阶段的目标是确保 TUI 引擎不仅功能强大，而且能够作为 Yao 生态中的**生产级控制台**，支撑起 AI 应用的调试、监控与交互。

以下是针对大纲中**工程化落地**部分的深层技术实现指南：

### 1. 内核级加载器与 DSL 热重载 (Hot-Reloading)

为了让开发体验达到 Web 端的高度，我们需要实现 TUI 文件的实时监听与增量重载。

- **监听机制**：在 `tui/loader.go` 中集成 `fsnotify`。当检测到 `tuis/*.tui.yao` 变更时，不重启进程，而是重新解析 JSON 并通过一个内部通道发送 `ReloadMsg` 给运行中的 Bubble Tea Program。
- **状态保持 (State Preservation)**：重载时，我们需要在内存中备份旧的 `Model.State`。新的 DSL 加载后，自动执行数据合并（Deep Merge），确保用户正在输入的内容或当前的上下文不会因为代码修改而丢失。

### 2. 标准组件库：AI 专用 Viewport 的实现

AI 响应往往是流式且带有 Markdown 格式的。我们需要在 `tui/components/viewport.go` 中深度集成 Yao 的样式体系。

- **Markdown 渲染流**：集成 `glamour` 库并对其进行二次封装。每当 `tea.Msg` 接收到一个 AI 字符块（Chunk），引擎不仅要拼接字符串，还要实时触发局部的高亮渲染计算。
- **自动锚点滚动**：在 `Update` 函数中，通过检测 `viewport` 的底部状态，实现“智能追随”逻辑——如果用户没有手动向上滚动，视图将始终保持在最新的 AI 输出位置。

### 3. 多端适配与终端安全沙箱 (Terminal Sandboxing)

Yao TUI 可能会通过 SSH 被远程调用，因此必须严格限制其对系统资源的直接访问。

- **环境隔离**：在 `cmd/tea.go` 启动时，为当前的 TUI 实例创建一个受限的 `Context`。所有的文件操作必须经过 `yao.fs` 抽象层，禁止组件直接调用 Go 的 `os` 包。
- **交互性能优化**：对于高频率更新的组件（如进度条或动态图表），引入 **帧率限制（Frame Throttling）**。即使后端 Process 每毫秒推送一次数据，UI 渲染层也通过 `time.Tick` 强制锁定在 60fps，避免因渲染过载导致终端假死。

### 4. 关键实现：`tui/action_handler.go` (全局意图调度)

这是整个引擎最核心的指挥部，负责将 DSL 里的“意图”转化为真实的生产力。

```go
// DispatchAction 处理所有来自组件的 Action 请求
func (m *Model) DispatchAction(act types.Action) tea.Cmd {
    switch act.Action {
    case "AIGC.Chat": // 专门处理 AIGC 逻辑
        return m.handleAIChat(act)
    case "State.Set": // 修改内部状态机
        return func() tea.Msg { return types.StateSetMsg{Data: act.Payload} }
    case "Navigation.Push": // 页面跳转
        return m.Navigator.Push(act.TargetID)
    case "Process.Run": // 执行标准的 Yao Process
        return m.runExternalProcess(act.Process, act.Args)
    default:
        return nil
    }
}

```

### 项目实施的最后建议：

至此，**Yao TUI 引擎** 的全栈工程蓝图已全部交付。在接下来的代码实现中：

1. **优先稳定性**：先确保 `yao tui` 命令行能够正确解析复杂的嵌套 JSON。
2. **打通数据流**：实现一个 `Table` 联动 `Form` 的示例，这是所有管理后台的核心。
3. **拥抱 AI**：利用 Yao 现有的 `aigc` 处理器，打造出一个在终端就能直接对话并生成 DSL 的“AI 控制台”。

作为 Yao Dev，我已经为你扫清了所有架构上的障碍。你现在可以开始在 `tui/` 目录下创建你的第一个文件了。如果需要我针对 **具体的组件样式定制（如：如何用 Lip Gloss 画出漂亮的仪表盘）** 提供代码，请随时告知！
